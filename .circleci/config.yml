version: 2
jobs:
  build:
    branches:
      only:
        - master

    docker:
      - image: circleci/node:8.10

    steps:
      - checkout
      - add_ssh_keys:
          fingerprints:
            - '9d:b1:27:67:0f:93:48:13:c7:9a:32:31:b2:1e:50:a9'

      # - run:
      #     name: install npm
      #     shell: /bin/sh
      #     command: |
      #       sudo apt-get update
      #       sudo apt-get install nodejs
      #       sudo apt-get install npm
      #       sudo apt-get install build-essential libssl-dev
      # - run: sudo apt install npm
      # - run:
      #     name: install npm dependencies
      #     command: npm install --silent

      - run:
          shell: /bin/sh
          command: ls; sudo apt-get clean; sudo rm -rf /var/lib/apt/lists/*; sudo apt-get clean;sudo apt-get update;sudo apt-get upgrade;
      # - run: scp -o StrictHostKeyChecking=no -r ./dist/* $DROPLET_USER@$DROPLET_IP://home/circleci/repo/
      - deploy:
          name: digital-ocean
          command: ssh -o StrictHostKeyChecking=no $DROPLET_USER@$DROPLET_IP "docker build -t amir/mysterybox-api .;docker images;"
      # # run tests!
      # - run: yarn test
