version: 2
jobs:
  build:
    branches:
      only:
        - master

    docker:
      - image: circleci/node:8.10

    steps:
      - checkout
      - add_ssh_keys:
          fingerprints:
            - "db:fb:12:b8:63:a4:5a:4c:e5:35:ca:d8:0e:ad:b2:6b"

      - run: apt install npm
      - run: 
          name: install-dependencies
          command: npm install --silent

      - run:
          shell: /bin/sh
          command: ls
      # - run: scp -o StrictHostKeyChecking=no -r ./dist/* $DROPLET_USER@$DROPLET_IP://home/circleci/repo/ 
      - deploy:
          name: digital-ocean
          command: ssh -o StrictHostKeyChecking=no $DROPLET_USER@$DROPLET_IP "cd ~/mysteryBox-api; git pull; npm install; forever start src/main.js"

      # # run tests!
      # - run: yarn test